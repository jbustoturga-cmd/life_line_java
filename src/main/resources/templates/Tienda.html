<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LifeLine - Tienda de Bienestar</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
/* ============================================================
   VARIABLES DE COLOR Y ESTILO PRINCIPALES.
   ============================================================ */
:root {
    --color-primary: #3d5273;
    --color-secondary: #5b6e94;
    --color-accent: #4f3b69;
    --color-text-dark: #1a1a1a;
    --color-text-light: #555;
    --color-bg-light: #f0f2f5;
    --color-bg-white: rgb(206, 217, 226);
    --color-menu-bg: #526eaa;
    --color-menu-hover: #2d3c7e;
    --color-top-bar-bg: linear-gradient(135deg, #040418, #102468);
    --border-radius-lg: 10px;
    --border-radius-sm: 5px;
}

/* Reset básico */
* { box-sizing: border-box; margin: 0; padding: 0; }

/* ============================================================
   ESTILOS GENERALES DEL CUERPO
   ============================================================ */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #b7bdd8, #162149);
    color: var(--color-text-dark);
    line-height: 1.6;
}

a { text-decoration: none; }

/* ============================================================
   BARRA SUPERIOR
   ============================================================ */
.header-bar {
     background: linear-gradient(135deg, #ffffff, #d2daf5);
    border-bottom: 1px solid #ddd;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    padding: 10px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

/* Sección del logo */
.header-logo-section {
    display: flex;
    align-items: center;
    font-size: 28px;
    font-weight: bold;
    color: var(--color-primary);
}


.header-logo-section img {
    width: 35px;
    margin-right: 5px;
    object-fit: contain;
}

/* ============================================================
   MENÚ PRINCIPAL (Pestañas de navegación)
   ============================================================ */
.main-tabs {
    background-color: #2d3e5f;
    display: flex;
    padding: 0 20px;
}
.main-tabs a {
    color: white;
    padding: 10px 20px;
    font-weight: 600;
    border-right: 1px solid rgba(255,255,255,0.1);
    transition: background-color 0.2s;
}
.main-tabs a:hover { background-color: #3b507b; }
.main-tabs a.active { background-color: var(--color-menu-bg); }

/* ============================================================
   LAYOUT GENERAL
   ============================================================ */
.page-layout {
    display: flex;
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    gap: 20px;
}

/* ============================================================
   SIDEBAR ADMIN.
   ============================================================ */
.admin-sidebar {
    width: 250px;
    background-color: var(--color-menu-bg);
    border-radius: 0 var(--border-radius-lg) var(--border-radius-lg) 0;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    color: white;
    padding: 15px 0;
}

.admin-menu-title {
    font-size: 16px;
    font-weight: bold;
    padding: 10px 20px;
    margin-bottom: 10px;
    border-bottom: 1px solid var(--color-menu-hover);
}

.admin-menu a {
    display: flex;
    align-items: center;
    color: white;
    padding: 10px 20px;
    font-size: 14px;
    transition: background-color 0.2s;
}

.admin-menu a i { margin-right: 10px; }
.admin-menu a:hover { background-color: var(--color-menu-hover); }

.admin-menu .menu-separator {
    height: 1px;
    background-color: var(--color-menu-hover);
    margin: 10px 20px;
}

.admin-menu .submenu-toggle {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
}

.admin-menu .submenu {
    padding-left: 20px;
    background-color: #2d619c;
}

.admin-menu .submenu a {
    padding-left: 30px;
    font-weight: normal;
    font-size: 13px;
}


.admin-menu .submenu a.active {
    background-color: #243666;
}

/* ============================================================
   CONTENIDO PRINCIPAL
   ============================================================ */
.main-content {
    flex-grow: 1;
    background-color: var(--color-bg-white);
    padding: 20px;
    box-shadow: 0 0 5px rgba(0,0,0,0.05);
}

.content-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    border-bottom: 2px solid #eee;
    padding-bottom: 10px;
}

.content-header h2 {
    font-size: 24px;
    color: var(--color-primary);
}

/* Logo principal */
.logo-area {
    display: flex;
    align-items: center;
    gap: 10px;
}

.logo-text {
    font-size: 32px;
    font-weight: bold;
    line-height: 28px;
    color: #0e1330;
}
/* ICONO USUARIO */
    .user-photo {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      overflow: hidden;
      border: 2px solid #0e1330;
      display: flex;
      justify-content: center;
      align-items: center;
  
    }

    .user-photo img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }


     .navbar-icon a {
            color: var(--color-text-dark);
            font-size: 24px;
            padding: 0 10px;
            transition: color 0.2s;
        }

        .navbar-icon a:hover {
            color: var(--color-secondary);
        }

        .navbar-icon.active a {
            color: var(--color-primary);
        }
        
        .navbar-right {
          display: flex;
    align-items: center;
    gap: 0px;
    margin-left: 700px;
}
/* ============================================================
   BUSCADOR
   ============================================================ */
 /* Campo de búsqueda mejorado y más limpio */
        .search-box {
            background-color: rgba(213, 188, 235, 0.2);
            border-radius: 20px;
            padding: 5px 15px;
            display: flex;
            align-items: center;
            border: 1px solid rgba(19, 18, 71, 0.3);
        }
        .search-box input {
            border: none;
            background: none;
            outline: none;
            font-size: 15px;
            color: rgb(15, 17, 54);
            width: 250px;
            margin-left: 8px;
        }
        .search-box input::placeholder {
            color: rgba(48, 27, 95, 0.7);
        }
        .search-box i {
            color: rgb(25, 18, 65);
            font-size: 16px;
        }
        

/* ============================================================
   GRID PRODUCTOS
   ============================================================ */
.product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
}

.product-card {
    background-color: white;
    border-radius: var(--border-radius-lg);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    overflow: hidden;
    text-align: center;
    transition: transform 0.2s ease-in-out;
    cursor: pointer;
    display: flex;
    flex-direction: column;
}

.product-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.product-image-container {
    width: 100%;
    height: 200px;
    background-color: #f8f8f8;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: center;
    align-items: center;
}

.product-image {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.product-info {
    padding: 15px;
    flex-grow: 1;
}


.product-name {
    font-size: 18px;
    font-weight: 600;
    color: var(--color-text-dark);
    margin-bottom: 8px;
}

.product-price {
    font-size: 20px;
    font-weight: bold;
    color: var(--color-accent);
    margin-top: 10px;
}

.add-to-cart {
    padding: 10px;
    background-color: #3d5273;
    color: white;
    border: none;
    cursor: pointer;
    width: 100%;
    transition: background-color 0.3s;
}

.add-to-cart:hover {
    background-color: var(--color-secondary);
}

.add-to-cart:disabled {
    background-color: #999;
    cursor: not-allowed;
}

/* Notificación de éxito */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background-color: #4CAF50;
    color: white;
    padding: 15px 20px;
    border-radius: 5px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    z-index: 1000;
    animation: slideIn 0.3s ease-out;
}

.notification.error {
    background-color: #f44336;
}

@keyframes slideIn {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* ============================================================
   RESPONSIVE.
   ============================================================ */
@media (min-width: 1150px) {
    .side-column { display: block; }
}

@media (max-width: 700px) {
    .search-box { display: none; }
}

/* ============================================================
   CONTADOR DEL CARRITO
   ============================================================ */
.navbar-right {
    display: flex;
    align-items: center;
    gap: 15px;
}

.cart-icon {
    position: relative;
}

.cart-icon a {
    color: #2d3e5f;
    font-size: 24px;
    position: relative;
    display: inline-block;
}

#cart-count {
    position: absolute;
    top: -8px;
    right: -10px;
    background-color: #ff4d4d;
    color: white;
    border-radius: 50%;
    padding: 2px 6px;
    font-size: 12px;
    font-weight: bold;
    min-width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.user-photo {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    overflow: hidden;
}

.user-photo img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}
</style>
</head>

<body>

<div class="header-bar">
    <div class="header-logo-section">
        <div class="logo-text">Life<br>Line</div>
        <img th:src="@{/imagenes/Group 243 (3).png}" width="55" alt="logo">
    </div>
    
    <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Buscar en LifeLine...">
    </div>

    <div class="navbar-right">
        <div class="navbar-icon cart-icon">
            <a th:href="@{/carrito}">
                <i class="fas fa-shopping-cart" title="Carrito"></i>
                <span id="cart-count">0</span>
            </a>
        </div>
        
        <div class="user-photo">
            <img th:src="@{/imagenes/Group 244.png}" alt="Logo LifeLine">
        </div>
    </div>
</div>

<nav class="main-tabs">
    <a th:href="@{/home}"><i class="fas fa-home" title="Inicio"></i>Inicio</a>
    <a th:href="@{/Mural}"><i class="fas fa-user-friends"></i>Mural</a>
    <a th:href="@{/Perfil}"><i class="fas fa-user"></i>Perfil</a>
    <a th:href="@{/Tienda}" class="active"><i class="fas fa-store" title="Tienda"></i>Productos</a>
    <a th:href="@{/calendario}"><i class="fas fa-calendar-alt" title="Calendario"></i>Calendario</a>
    <a th:href="@{/nutricion}"><i class="fas fa-apple-alt"></i>Nutrición</a>
    <a th:href="@{/alarma}"><i class="fas fa-clock"></i>Alarmas</a>
    <a th:href="@{/contactanos}">Contactanos</a>
</nav>

<div class="page-layout">

    <aside class="admin-sidebar">
        <div class="admin-menu-title">Menú de Gestión</div>

        <div class="admin-menu">
            <a th:href="@{/productos/nuevo}"><i class="fas fa-plus-circle"></i>Crear nuevo producto</a>
            <a th:href="@{/bloques}"><i class="fas fa-layer-group"></i>Gestionar bloques</a>
             
            <div class="filter-header">
                <a href="#" class="submenu-toggle"><i class="fas fa-store"></i>Categoria<i class="fas fa-caret-down"></i></a>
                <div class="submenu">
                    <div class="filter-content" id="categoryFilter">
                        <ul class="category-list">
                            <a th:href="@{/Tienda}" class="active"><i class="fas fa-angle-right"></i>Todos los productos</a>
                            <a th:href="@{/productos/categoria/piel}"><i class="fas fa-angle-right"></i>Cuidado de la Piel</a>
                            <a th:href="@{/productos/categoria/accesorios}"><i class="fas fa-angle-right"></i>Accesorios y Ropa</a>
                            <a th:href="@{/productos/categoria/bienestar}"><i class="fas fa-angle-right"></i>Bienestar y Relax</a>
                            <a th:href="@{/productos/categoria/organizacion}"><i class="fas fa-angle-right"></i>Organización y Terapia</a>
                        </ul>
                    </div>
                </div>
            </div>

            <a href="#" class="submenu-toggle"><i class="fas fa-store"></i>Tienda<i class="fas fa-caret-down"></i></a>

            <div class="submenu">
                <a th:href="@{/productos}" class="active"><i class="fas fa-angle-right"></i>Ver todos los Productos</a>
                <a th:href="@{/productos}"><i class="fas fa-angle-right"></i>lista productos</a>
                <a th:href="@{/usuarios/nuevo}"><i class="fas fa-angle-right"></i>Crear Cliente nuevo</a>
            </div>

            <a th:href="@{/descuentos}"><i class="fas fa-tags"></i>Descuentos</a>
            <a th:href="@{/pedidos}"><i class="fas fa-clipboard-list"></i>Pedidos</a>
            <a th:href="@{/usuarios}"><i class="fas fa-users"></i>Usuarios registrados</a>

            <div class="menu-separator"></div>

            <a th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i>Salir</a>
        </div>
    </aside>

    <div class="main-content">

        <div class="content-header">
            <h2 style="color: #2d3e5f;">Catálogo de productos</h2>

            <div class="search-box">
                <input type="text" placeholder="Buscar Producto">
                <i class="fas fa-search"></i>
            </div>
        </div>

        <div class="product-grid">

            <div class="product-card" th:each="producto : ${productos}">
                <a th:href="@{/producto/{id}(id=${producto.id})}">
                    <div class="product-image-container">
                        <img th:src="@{'/' + ${producto.imagen}}"
                             th:alt="${producto.nombre}"
                             class="product-image"
                             onerror="this.src='https://placehold.co/200x200/f8f8f8/999?text=Sin+Imagen'">
                    </div>


                    <div class="product-info">
                        <p class="product-name" th:text="${producto.nombre}"></p>
                        <p class="product-price"
                           th:text="${#numbers.formatDecimal(producto.precioFinal, 1, 'POINT', 2, 'COMMA') + ' COP'}">
                        </p>
                    </div>
                </a>

                <button type="button" 
                        class="add-to-cart" 
                        th:data-product-id="${producto.id}"
                        onclick="addToCart(this)">
                    Añadir al Carrito
                </button>
            </div>

        </div>
    </div>
</div>

<script th:inline="javascript">
const USER_ID = /*[[${usuarioId}]]*/ 1;

/**
 * Actualiza el contador del carrito
 */
async function updateCartCount() {
    try {
        const response = await fetch(`/api/carrito/${USER_ID}`);
        if (response.ok) {
            const cartItems = await response.json();
            const totalItems = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cart-count').textContent = totalItems;
        }
    } catch (error) {
        console.error('Error al actualizar contador del carrito:', error);
    }
}

/**
 * Función para añadir un producto al carrito
 */
async function addToCart(button) {
    const productId = button.getAttribute('data-product-id');
    
    // Deshabilitar el botón mientras se procesa
    button.disabled = true;
    button.textContent = 'Agregando...';
    
    try {
        const response = await fetch(`/api/carrito/${USER_ID}/add`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                productId: parseInt(productId),
                quantity: 1,
                productOptions: null
            })
        });
        
        if (response.ok) {
            const data = await response.json();
            showNotification('¡Producto añadido al carrito!', 'success');
            
            // Actualizar_contador del carrito
            await updateCartCount();
            
            // Restaurar el botón
            button.disabled = false;
            button.textContent = 'Añadir al Carrito';
        } else {
            const errorText = await response.text();
            showNotification('Error: ' + errorText, 'error');
            
            // Restaurar el botón
            button.disabled = false;
            button.textContent = 'Añadir al Carrito';
        }
    } catch (error) {
        console.error('Error al añadir al carrito:', error);
        showNotification('Error de conexión. Intenta de nuevo.', 'error');
        
        // Restaurar el botón
        button.disabled = false;
        button.textContent = 'Añadir al Carrito';
    }
}

/**
 * Función para mostrar notificaciones
 */
function showNotification(message, type = 'success') {
    // Crear elemento de notificación
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    
    // Añadir al body
    document.body.appendChild(notification);
    
    // Remover después de 3 segundos
    setTimeout(() => {
        notification.style.animation = 'slideIn 0.3s ease-out reverse';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}

// Cargar el contador al inicio
window.onload = function() {
    updateCartCount();
};
</script>

</body>
</html>